<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±å…¥æ·ºå‡º Promise èˆ‡ React Suspense</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        .step-card {
            background-color: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            margin-bottom: 2.5rem;
            border: 1px solid #e5e7eb;
            transition: all 0.3s ease-in-out;
        }
        .step-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        .step-number {
            background-color: #3b82f6;
            color: white;
            border-radius: 9999px;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            margin-right: 1.5rem;
            flex-shrink: 0;
        }
        .code-block {
            background-color: #1f2937;
            color: #d1d5db;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            overflow-x: auto;
            margin-top: 1rem;
            margin-bottom: 1rem;
        }
        .button {
            background-color: #3b82f6;
            color: white;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            border: none;
            margin-right: 0.5rem;
            margin-top: 0.5rem;
        }
        .button:hover {
            background-color: #2563eb;
        }
        .button-secondary {
            background-color: #4b5563;
        }
        .button-secondary:hover {
            background-color: #374151;
        }
         .button-negative {
            background-color: #ef4444;
        }
        .button-negative:hover {
            background-color: #dc2626;
        }
        .status-box {
            border: 2px dashed #9ca3af;
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            text-align: center;
            font-size: 1.25rem;
            font-weight: 700;
            transition: all 0.3s ease;
        }
        .status-pending { color: #f59e0b; border-color: #f59e0b; }
        .status-fulfilled { color: #22c55e; border-color: #22c55e; }
        .status-rejected { color: #ef4444; border-color: #ef4444; }

        .suspense-container {
            border: 2px solid #6366f1;
            padding: 2rem;
            border-radius: 12px;
            background: linear-gradient(145deg, #f9fafb, #e5e7eb);
            margin-top: 1.5rem;
        }
        .fallback-ui {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #4f46e5;
            height: 150px;
        }
        .spinner {
            width: 48px;
            height: 48px;
            border: 5px solid #4f46e5;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
            margin-bottom: 1rem;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600 mb-2">æ·±å…¥æ·ºå‡º Promise èˆ‡ React Suspense</h1>
            <p class="text-lg text-gray-600">ä¸€å€‹é—œæ–¼ã€Œæ°¸é ç­‰å¾…ã€çš„ Promise çš„äº’å‹•æ•…äº‹</p>
        </header>

        <main>
            <!-- æ­¥é©Ÿä¸€ï¼šæ­£å¸¸çš„ Promise -->
            <div class="step-card">
                <div class="flex items-start">
                    <div class="step-number">1</div>
                    <div>
                        <h2 class="text-3xl font-bold mb-2">ä¸€åˆ‡çš„èµ·é»ï¼šæ­£å¸¸çš„ Promise</h2>
                        <p class="text-gray-600">åœ¨æ·±å…¥ä¹‹å‰ï¼Œæˆ‘å€‘å…ˆè¤‡ç¿’ä¸€ä¸‹ Promise æ˜¯ä»€éº¼ã€‚æƒ³åƒå®ƒæ˜¯ä¸€å€‹ã€Œæ‰¿è«¾ã€ï¼Œä¿è­‰åœ¨æœªä¾†æŸå€‹æ™‚é–“é»æœƒçµ¦ä½ ä¸€å€‹çµæœï¼Œå¯èƒ½æ˜¯ã€ŒæˆåŠŸã€æˆ–ã€Œå¤±æ•—ã€ã€‚</p>
                    </div>
                </div>

                <div class="code-block">
                    <pre><code>const myPromise = new Promise((resolve, reject) => {
  // é€™è£¡åŸ·è¡Œä¸€äº›éœ€è¦æ™‚é–“çš„å·¥ä½œï¼Œä¾‹å¦‚è·Ÿä¼ºæœå™¨è¦è³‡æ–™
  // ... å·¥ä½œå®Œæˆå¾Œ ...
  // å¦‚æœæˆåŠŸï¼Œå°±å‘¼å« resolve()
  // å¦‚æœå¤±æ•—ï¼Œå°±å‘¼å« reject()
});</code></pre>
                </div>
                
                <p>ä¸‹é¢æˆ‘å€‘ä¾†æ¨¡æ“¬ä¸€ä¸‹ã€‚é»æ“ŠæŒ‰éˆ•ï¼Œçœ‹çœ‹é€™å€‹ Promise çš„ç‹€æ…‹å¦‚ä½•è®ŠåŒ–ï¼š</p>
                
                <div class="mt-4">
                    <button class="button" onclick="runNormalPromise(true)">åŸ·è¡ŒæˆåŠŸ (Resolve)</button>
                    <button class="button button-negative" onclick="runNormalPromise(false)">åŸ·è¡Œå¤±æ•— (Reject)</button>
                </div>

                <div id="status-box-1" class="status-box status-pending">
                    ç‹€æ…‹: â³ ç­‰å¾…ä¸­ (Pending)
                </div>
            </div>

            <!-- æ­¥é©ŸäºŒï¼šç©º Executor çš„ Promise -->
            <div class="step-card">
                <div class="flex items-start">
                    <div class="step-number">2</div>
                    <div>
                        <h2 class="text-3xl font-bold mb-2">ä¸€å€‹å¥‡ç‰¹çš„ Promiseï¼š() => {}</h2>
                        <p class="text-gray-600">ç¾åœ¨ï¼Œä¾†çœ‹æˆ‘å€‘ä»Šå¤©çš„ä¸»è§’ã€‚å¦‚æœæˆ‘å€‘çµ¦ `new Promise` ä¸€å€‹ç©ºçš„å‡½å¼æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿ</p>
                    </div>
                </div>

                <div class="code-block">
                    <pre><code>const endlessPromise = new Promise(() => {});

// é€™å€‹å‡½å¼è£¡é¢...
// - æ²’æœ‰å‘¼å« resolve()
// - æ²’æœ‰å‘¼å« reject()
// - ä»€éº¼äº‹éƒ½æ²’åšï¼</code></pre>
                </div>
                
                <p>é€™å€‹ Promise å°±åƒä¸€å€‹èªªäº†ã€Œæˆ‘ä¿è­‰ã€å»å¾ä¸çµ¦å‡ºçµæœçš„æœ‹å‹ã€‚å®ƒæ—¢ä¸èªªæˆåŠŸï¼Œä¹Ÿä¸èªªå¤±æ•—ã€‚å› æ­¤ï¼Œå®ƒæœƒæ°¸é è™•æ–¼ã€Œç­‰å¾…ä¸­ã€(Pending) çš„ç‹€æ…‹ã€‚é»æ“Šä¸‹æ–¹æŒ‰éˆ•ä¾†å»ºç«‹å®ƒï¼Œä½ æœƒç™¼ç¾å®ƒçš„ç‹€æ…‹æ°¸é ä¸æœƒæ”¹è®Šã€‚</p>

                <div class="mt-4">
                    <button class="button button-secondary" onclick="createEndlessPromise()">å»ºç«‹ä¸€å€‹æ°¸é ç­‰å¾…çš„ Promise</button>
                </div>

                 <div id="status-box-2" class="status-box status-pending">
                    ç‹€æ…‹: â³ ç­‰å¾…ä¸­ (Pending)
                </div>
            </div>

            <!-- æ­¥é©Ÿä¸‰ï¼šReact Suspense æ¨¡æ“¬ -->
            <div class="step-card">
                <div class="flex items-start">
                    <div class="step-number">3</div>
                    <div>
                        <h2 class="text-3xl font-bold mb-2">çµ‚æ¥µæ‡‰ç”¨ï¼šReact Suspense çš„é­”æ³•</h2>
                        <p class="text-gray-600">React Suspense æ˜¯ä¸€å€‹è°æ˜çš„æ©Ÿåˆ¶ã€‚ç•¶ä¸€å€‹å…ƒä»¶åœ¨æ¸²æŸ“æ™‚éœ€è¦ç­‰å¾…éåŒæ­¥è³‡æ–™ï¼Œå®ƒå¯ä»¥ã€Œæš«åœã€æ¸²æŸ“ï¼Œä¸¦é¡¯ç¤ºä¸€å€‹å‚™ç”¨çš„è¼‰å…¥ç•«é¢ (Fallback UI)ã€‚</p>
                        <p class="mt-2">å®ƒçš„å·¥ä½œåŸç†æ˜¯ï¼šå¦‚æœä¸€å€‹å…ƒä»¶åœ¨æ¸²æŸ“éç¨‹ä¸­ã€Œä¸Ÿå‡º (throw)ã€ä¸€å€‹ Promiseï¼ŒSuspense å°±æœƒæ•æ‰åˆ°å®ƒï¼Œç„¶å¾Œç­‰å¾…é€™å€‹ Promise å®Œæˆã€‚ </p>
                    </div>
                </div>
                
                 <div class="code-block">
                    <pre><code>function MyComponent() {
  const data = useData(); // å‡è¨­é€™å€‹ Hook åœ¨è³‡æ–™æœªæº–å‚™å¥½æ™‚...
  return &lt;div&gt;{data}&lt;/div&gt;;
}

function useData() {
  if (!dataIsReady) {
    // ...å°±ä¸Ÿå‡ºä¸€å€‹ Promise ä¾†ã€Œæš«åœã€æ¸²æŸ“ï¼
    throw new Promise(resolve => { /* ...å»è¼‰å…¥è³‡æ–™... */ });
  }
  return data;
}

// React æœƒåƒé€™æ¨£è™•ç†
&lt;Suspense fallback={&lt;LoadingSpinner /&gt;}&gt;
  &lt;MyComponent /&gt;
&lt;/Suspense&gt;
</code></pre>
                </div>

                <p class="font-bold text-lg mt-6">ç¾åœ¨ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ç•¶æˆ‘å€‘ä¸Ÿå‡ºã€Œæ°¸é ç­‰å¾…çš„ Promiseã€æ™‚æœƒç™¼ç”Ÿä»€éº¼äº‹ï¼š</p>

                <div class="suspense-container">
                    <h3 class="text-2xl font-bold text-center text-indigo-700 mb-4">React Suspense æ¨¡æ“¬å™¨</h3>
                    <div id="suspense-demo-area" class="text-center bg-white p-6 rounded-lg shadow-inner min-h-[150px] flex items-center justify-center">
                        <p class="text-gray-500">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æ¸²æŸ“å…ƒä»¶</p>
                    </div>
                    <div class="flex justify-center flex-wrap mt-6">
                        <button class="button" onclick="runSuspenseDemo(false)">æ¸²æŸ“ã€Œæœƒå®Œæˆã€çš„å…ƒä»¶</button>
                        <button class="button button-negative" onclick="runSuspenseDemo(true)">æ¸²æŸ“ã€Œæ°¸é ç­‰å¾…ã€çš„å…ƒä»¶</button>
                         <button class="button button-secondary" onclick="resetSuspenseDemo()">é‡è¨­</button>
                    </div>
                </div>
            </div>

            <!-- ç¸½çµ -->
            <div class="step-card bg-blue-50 border-blue-200">
                <div class="flex items-start">
                    <div class="step-number">ğŸ‰</div>
                     <div>
                        <h2 class="text-3xl font-bold mb-2">ç¸½çµ</h2>
                        <p class="text-gray-700">
                            `throw new Promise(() => {});` é€™è¡Œç¨‹å¼ç¢¼çš„å¨åŠ›åœ¨æ–¼ï¼š
                        </p>
                        <ul class="list-disc list-inside mt-4 space-y-2 text-lg">
                            <li>å®ƒå»ºç«‹äº†ä¸€å€‹<strong class="text-blue-600">æ°¸é ä¸æœƒçµæŸçš„ Promise</strong>ã€‚</li>
                            <li>ç•¶åœ¨ React å…ƒä»¶ä¸­<strong class="text-blue-600">ä¸Ÿå‡º (throw)</strong> é€™å€‹ Promise æ™‚...</li>
                            <li>React Suspense æœƒæ•æ‰åˆ°å®ƒï¼Œä¸¦å¿ å¯¦åœ°<strong class="text-blue-600">æ°¸é é¡¯ç¤º Fallback è¼‰å…¥ç•«é¢</strong>ã€‚</li>
                        </ul>
                        <p class="mt-4 text-gray-700">é€™æ˜¯ä¸€ç¨®å¼·å¤§çš„æŠ€å·§ï¼Œå¯ä»¥ç”¨æ–¼æŸäº›ç‰¹æ®Šå ´æ™¯ï¼Œä¾‹å¦‚åœ¨ Storybook ä¸­å±•ç¤ºå…ƒä»¶çš„è¼‰å…¥ç‹€æ…‹ï¼Œæˆ–è€…åœ¨ç‰¹å®šæƒ…æ³ä¸‹æ•…æ„è®“ä¸€éƒ¨åˆ† UI ä¿æŒåœ¨è¼‰å…¥ä¸­ã€‚ç¾åœ¨ï¼Œæ‚¨å·²ç¶“å®Œå…¨æŒæ¡é€™å€‹æ¦‚å¿µäº†ï¼</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- æ­¥é©Ÿä¸€ è…³æœ¬ ---
        const statusBox1 = document.getElementById('status-box-1');

        function runNormalPromise(shouldResolve) {
            statusBox1.className = 'status-box status-pending';
            statusBox1.innerHTML = 'ç‹€æ…‹: â³ ç­‰å¾…ä¸­ (Pending)';

            const normalPromise = new Promise((resolve, reject) => {
                // æ¨¡æ“¬ä¸€å€‹ç¶²è·¯è«‹æ±‚ï¼Œå»¶é² 1.5 ç§’
                setTimeout(() => {
                    if (shouldResolve) {
                        resolve("è³‡æ–™å›ä¾†äº†ï¼");
                    } else {
                        reject("ä¼ºæœå™¨å‡ºéŒ¯äº†ï¼");
                    }
                }, 1500);
            });

            normalPromise
                .then(result => {
                    statusBox1.className = 'status-box status-fulfilled';
                    statusBox1.innerHTML = `ç‹€æ…‹: âœ… æˆåŠŸ (Fulfilled) <br><small class="font-normal">${result}</small>`;
                })
                .catch(error => {
                    statusBox1.className = 'status-box status-rejected';
                    statusBox1.innerHTML = `ç‹€æ…‹: âŒ å¤±æ•— (Rejected) <br><small class="font-normal">${error}</small>`;
                });
        }

        // --- æ­¥é©ŸäºŒ è…³æœ¬ ---
        const statusBox2 = document.getElementById('status-box-2');
        function createEndlessPromise() {
            statusBox2.className = 'status-box status-pending';
            statusBox2.innerHTML = 'ç‹€æ…‹: â³ æ°¸é ç­‰å¾…ä¸­... (Forever Pending)';
            
            // é€™å°±æ˜¯é‚£å€‹æ°¸é ä¸æœƒæ”¹è®Šç‹€æ…‹çš„ Promise
            const endlessPromise = new Promise(() => {});

            // å› ç‚ºå®ƒæ°¸é ä¸æœƒ resolve æˆ– rejectï¼Œæ‰€ä»¥ .then æˆ– .catch æ°¸é ä¸æœƒè¢«è§¸ç™¼
            endlessPromise.then(() => {
                // é€™æ®µç¨‹å¼ç¢¼æ°¸é ä¸æœƒåŸ·è¡Œ
                statusBox2.innerHTML = 'é€™ä¸å¯èƒ½ç™¼ç”Ÿï¼';
            });
        }

        // --- æ­¥é©Ÿä¸‰ è…³æœ¬ ---
        const suspenseArea = document.getElementById('suspense-demo-area');
        const fallbackUI = `
            <div class="fallback-ui">
                <div class="spinner"></div>
                <p class="font-bold text-lg">æ­£åœ¨è¼‰å…¥è³‡æ–™ï¼Œè«‹ç¨å€™...</p>
            </div>`;
        const successUI = `
            <div class="text-center text-green-600">
                <h4 class="text-2xl font-bold">ğŸ‰ å…ƒä»¶è¼‰å…¥æˆåŠŸï¼</h4>
                <p>é€™æ˜¯æ‚¨ç­‰å¾…çš„è³‡æ–™å…§å®¹ã€‚</p>
            </div>`;
        const initialUI = `<p class="text-gray-500">é»æ“Šä¸‹æ–¹æŒ‰éˆ•é–‹å§‹æ¸²æŸ“å…ƒä»¶</p>`;
        
        // æ¨¡æ“¬ä¸€å€‹æœƒä¸Ÿå‡º Promise çš„å…ƒä»¶
        function dataFetchingComponent(shouldBeEndless) {
            if (shouldBeEndless) {
                // ä¸Ÿå‡ºæ°¸é ç­‰å¾…çš„ Promise
                throw new Promise(() => {});
            } else {
                // ä¸Ÿå‡ºä¸€å€‹ 2 ç§’å¾Œæœƒå®Œæˆçš„ Promise
                throw new Promise(resolve => {
                    setTimeout(() => {
                        resolve("æˆåŠŸè³‡æ–™");
                    }, 2000);
                });
            }
        }

        // æ¨¡æ“¬ React Suspense çš„é‹ä½œ
        function runSuspenseDemo(isEndless) {
            suspenseArea.innerHTML = 'æº–å‚™æ¸²æŸ“å…ƒä»¶...';
            
            // ç­‰å¾…ä¸€å°æ®µæ™‚é–“è®“ä½¿ç”¨è€…çœ‹åˆ°è¨Šæ¯
            setTimeout(() => {
                try {
                    // å˜—è©¦æ¸²æŸ“å…ƒä»¶ï¼Œé€™æœƒç«‹å³ä¸Ÿå‡ºä¸€å€‹ Promise
                    dataFetchingComponent(isEndless); 
                    // å› ç‚ºä¸Šé¢ä¸€å®šæœƒ throwï¼Œæ‰€ä»¥é€™è¡Œä¸æœƒåŸ·è¡Œ
                    suspenseArea.innerHTML = successUI;
                } catch (error) {
                    // æª¢æŸ¥ä¸Ÿå‡ºä¾†çš„æ˜¯ä¸æ˜¯ Promise (Suspense çš„æ ¸å¿ƒ)
                    if (error instanceof Promise) {
                        suspenseArea.innerHTML = fallbackUI; // é¡¯ç¤ºè¼‰å…¥ç•«é¢
                        
                        // ç­‰å¾… Promise å®Œæˆ
                        error
                            .then(() => {
                                // Promise å®Œæˆå¾Œï¼Œé¡¯ç¤ºæˆåŠŸç•«é¢
                                suspenseArea.innerHTML = successUI;
                            })
                            .catch(() => {
                                // åœ¨é€™å€‹ç¯„ä¾‹ä¸­æˆ‘å€‘ä¸è™•ç† reject
                            });
                    }
                }
            }, 200);
        }

        function resetSuspenseDemo() {
            suspenseArea.innerHTML = initialUI;
        }

    </script>

</body>
</html>

